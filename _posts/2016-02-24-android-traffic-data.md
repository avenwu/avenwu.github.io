---
layout: post
title: "androidæµé‡ç»Ÿè®¡"
header_image: /assets/img/2016-03-06-01.jpg
keywords: "æµé‡, ç»Ÿè®¡"
description: "android traffic data"
tags: [android]
---
{% include JB/setup %}

![img](/assets/img/2016-03-06-01.jpg)

## å‰è¨€

ç”¨è¿‡å„ç§æ‰‹æœºæ¸…ç†è½¯ä»¶çš„androidç”¨æˆ·éƒ½çŸ¥é“ï¼Œè¿™äº›è½¯ä»¶å¾€å¾€éƒ½å¯ä»¥æŸ¥è¯¢åº”ç”¨çš„æµé‡ä½¿ç”¨æƒ…å†µï¼›  
ä»å¼€å‘è€…çš„è§’åº¦æ¥è¯´ï¼Œç¬¬ä¸€ååº”å¾ˆå¯èƒ½æ˜¯â€œæ•°æ®ä»å“ªé‡Œæ¥çš„ï¼Ÿæ€ä¹ˆç®—çš„ï¼Ÿâ€ï¼Œæœ¬æ–‡å°±æ¥åˆ†æä¸€ä¸‹å¦‚ä½•è·å–Androidè®¾å¤‡ä¸Šæµé‡ä½¿ç”¨æƒ…å†µã€‚

## åˆ†æ
å®‰è£…appåéšä¾¿æµè§ˆç½‘é¡µï¼Œæ¶ˆè€—ç‚¹æµé‡ï¼Œæ‰“å¼€æ£€æµ‹è½¯ä»¶ï¼Œçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„ç»Ÿè®¡æ•°æ®ã€‚

![Screenshot_20160223-175015.png]({{ site.baseurl }}/assets/images/Screenshot_20160223-175015.png)

å…ˆå»å¼€å‘è€…ç½‘ç«™çœ‹çœ‹æœ‰æ²¡æœ‰ç›¸å…³æ¥å£
[http://developer.android.com/reference/android/net/TrafficStats.html](http://developer.android.com/reference/android/net/TrafficStats.html)

Androidæä¾›äº†TrafficStatsæ¥å£ï¼Œå¯ä»¥è·å–ä¸€äº›ç®€å•çš„æ•°æ®ï¼Œæ³¨æ„è¿™äº›æ•°æ®æ˜¯ç´¯è®¡çš„ï¼š

* getTotalRxBytes()
* getTotalTxBytes()
* getMobileTxBytes()
* getMobileRxBytes()
* getUidTxBytes(int uid)

æ–¹æ³•åçœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼ŒåŸºæœ¬ä¸Šæ˜¯txï¼Œrxé…å¥—å­˜åœ¨ï¼Œtxä»£è¡¨çš„æ˜¯ä¸Šè¡Œæˆ–è€…è¯´æ˜¯ä¸Šä¼ ï¼ˆt=>transmittedï¼‰ï¼Œrxä»£è¡¨çš„æ˜¯ä¸‹è¡Œ(r=>received);

å› æ­¤é€šè¿‡ç³»ç»Ÿçš„æ¥å£æˆ‘ä»¬å¯ä»¥çŸ¥é“å½“å‰ç³»ç»Ÿ/appç´¯è®¡æ¶ˆè€—çš„æ•°æ®åŒ…å’Œä¸Šä¼ çš„æ•°æ®åŒ…ï¼Œç§»åŠ¨ç½‘ç»œä¸‹çš„æ¶ˆè€—æƒ…å†µï¼›

å¦‚æœè¦ç”Ÿæˆæ¡å½¢å›¾ï¼Œé‚£ä¹ˆéœ€è¦å®šæœŸå§æ¶ˆè€—çš„æ•°æ®å­˜å‚¨èµ·æ¥ï¼Œè¿™æ ·éšç€æ—¶é—´æ¨ç§»ï¼Œå°±å¯ä»¥ç»˜åˆ¶å‡ºæ¯å¤©çš„æµé‡æ¶ˆè€—ï¼›

æ ¹æ®ç›®å‰ä¿¡æ¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®¡ç®—å‡ºè‡ªèº«appçš„æ•°æ®ä½¿ç”¨æƒ…å†µï¼Œé‚£å…¶ä»–appçš„æ•°æ®å‘¢ï¼Ÿå½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„é€šè¿‡åˆ¶å®šuidï¼Œæ¯ä¸ªåº”ç”¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šæœ‰ä¸€ä¸ªuidï¼Œè¿™ä¸ªuidæ ‡ç¤ºäº†å½“å‰è¿›ç¨‹ï¼›

è¦è·å–å…¶ä»–appçš„uidå¥½åƒä¸æ˜¯å¤ªå®¹æ˜“ï¼Œç°åœ¨å»çœ‹çœ‹å…¶ä»–åº”ç”¨æ˜¯æ€ä¹ˆè·å–åˆ°çš„ï¼›

## ç»Ÿè®¡ç±»appæ‹†åŒ…åˆ†æ
æœ¬æ–‡åˆ†æçš„onavo countï¼Œæ‹†å®ŒåŒ…å‘ç°onavoæ˜¯ä¸ªå¥½åŒå¿—å•Šï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿåº”ä¸ºæ··æ·†åšçš„å¾ˆå¥½å•Šï¼ŒåŸºæœ¬éƒ½æ˜¯æ˜æ–‡ï¼Œç›´æ¥å¯è¯»ã€‚

![package_folder.jpg]({{ site.baseurl }}/assets/images/package_folder.jpg)

é€šè¿‡å…³é”®æŸ¥æ‰¾ï¼Œæœ€ååœ¨è¿™é‡Œå‘ç°äº†æœ‰ä»·å€¼çš„ä¸œè¥¿

![read_xt_qtaguid.jpg]({{ site.baseurl }}/assets/images/read_xt_qtaguid.jpg)

å’Œå¾ˆå¤šé»‘æŠ€æœ¯ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç›´æ¥è¯»å–ç³»ç»Ÿæ–‡ä»¶ï¼Œå¦‚æœå¯¹linuxä½“ç³»ç†Ÿæ‚‰çš„è¯åº”è¯¥çŸ¥é“æ–‡ä»¶ç³»ç»Ÿå†…å„ä¸ªç›®å½•çš„ä½œç”¨ï¼Œå½“ç„¶ç¬”è€…å¹¶ä¸ç†Ÿæ‚‰linuxå†…æ ¸ï¼›

è¿æ¥è®¾å¤‡ï¼Œadbçœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶é‡Œé¢åˆ°åº•æ˜¯ä»€ä¹ˆ

![xt_qtaguid_content.jpg]({{ site.baseurl }}/assets/images/xt_qtaguid_content.jpg)

è¾“å‡ºäº†å¾ˆå¤šæ•°æ®ï¼Œæ¯ä¸€è¡Œé€šè¿‡ç©ºæ ¼åˆ†å‰²ï¼ŒåŸºæœ¬ä¸Šæ˜¯ä¸ªè¡¨æ ¼çš„æ„æ€ï¼Œç¬¬ä¸€è¡Œç›¸å½“äºè¡¨å¤´ï¼Œè¡¨ç¤ºæ¯ä¸ªçºµåˆ—çš„å«ä¹‰ï¼Œç¬¬äºŒè¡Œå¼€å§‹è¡¨ç¤ºæ¯ä¸ªæ¯ä¸ªè¿›ç¨‹çš„æ•°æ®æƒ…å†µï¼›

é‚£åˆ°åº•å“ªäº›åˆ—ä½¿æˆ‘ä»¬å…³æ³¨çš„å‘¢ï¼Ÿå…¶å®å°±æ˜¯å…³é”®çš„rxï¼Œtxï¼Œæˆ‘ä»¬çœ‹çœ‹onavoç”¨äº†å“ªäº›æ•°æ®

![read_stats_file.jpg]({{ site.baseurl }}/assets/images/read_stats_file.jpg)

ä¸å¾—ä¸æ„Ÿæ¦‚ï¼Œä½œè€…æ˜¯å¥½äººå•Šï¼Œå¤§å†™çš„èµğŸ‘

ç°åœ¨å…¶å®å°±å¯ä»¥ä»è¿™ä¸ªè¡¨ä¸­è·å–æ¯ä¸ªåº”ç”¨çš„æ•°æ®ä½¿ç”¨æƒ…å†µäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¸çŸ¥é“ç‰¹å®šåº”ç”¨çš„uidå•Šï¼Œåˆ«æ€¥åªè¦çŸ¥é“packageï¼Œå¯ä»¥ç”¨dumpsyså‘½ä»¤æŠŠå®ƒè¿‡æ»¤å‡ºæ¥

	dumpsys package com.example.myapp | grep userId=

å¾—åˆ°uidåï¼Œå¯ä»¥è¿‡æ»¤ç¬¬ä¸€ä¸ªè¡¨

	cat /proc/net/xt_qtaguid/stats | grep 10060

æœ€åå°±æ˜¯å°†è¿‡æ»¤å‡ºæ¥çš„æ•°æ®æ±‚å’Œï¼›

ä¸‹é¢ä»¥UCæµè§ˆå™¨åšæ¼”ç¤ºï¼š

1|root@vbox86p:/ # dumpsys package com.UCMobile.intl.x86 | grep userId=        
    userId=10068 gids=[3003, 1028, 1015]

å¾—åˆ°uidä¸º10068

```
root@vbox86p:/ # cat /proc/net/xt_qtaguid/stats | grep 10068                   
16 eth1 0x0 10068 0 2726 27 3028 60 2726 27 0 0 0 0 3028 60 0 0 0 0
17 eth1 0x0 10068 1 41345707 40808 1047668 19955 41345707 40808 0 0 0 0 1047668 19955 0 0 0 0
32 lo 0x0 10068 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
33 lo 0x0 10068 1 120 3 180 3 120 3 0 0 0 0 180 3 0 0 0 0
```

æ ¹æ®è¯¥uidå¾—åˆ°äº†å››è¡Œæ•°æ®ï¼›

è¡¨å¤´æ˜¯

```
idx iface acct_tag_hex uid_tag_int cnt_set rx_bytes rx_packets tx_bytes tx_packets rx_tcp_bytes rx_tcp_packets rx_udp_bytes rx_udp_packets rx_other_bytes rx_other_packets tx_tcp_bytes tx_tcp_packets tx_udp_bytes tx_udp_packets tx_other_bytes tx_other_packets
```

å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„rx_bytesä½äºç¬¬5ä½, tx_bytesä½äºç¬¬7ä½

## ç»“æŸè¯­

å½“ç„¶ï¼Œå¦‚æœç»§ç»­å¯¹onavoè„±è£¤ï¼Œåº”è¯¥èƒ½æŒ–åˆ°å…¶ä»–çš„å¥½ç©ä¸œè¥¿ï¼›å¦å¤–è¿‡è¿‡googleï¼Œæ‰¾åˆ°äº†ä¸¤ç¯‡å’Œlinuxå†…è¿™ä¸ªç»Ÿè®¡æ–‡ä»¶ç›¸å…³çš„æ–‡ç« 

* http://stackoverflow.com/questions/12904809/tracking-an-applications-network-statistics-netstats-using-adb
* https://testerhome.com/topics/2068

